(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-99c2ac90"],{"498a":function(e,t,n){"use strict";var r=n("23e7"),a=n("58a8").trim,o=n("c8d2");r({target:"String",proto:!0,forced:o("trim")},{trim:function(){return a(this)}})},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,n){var r=n("1d80"),a=n("5899"),o="["+a+"]",i=RegExp("^"+o+o+"*"),c=RegExp(o+o+"*$"),s=function(e){return function(t){var n=String(r(t));return 1&e&&(n=n.replace(i,"")),2&e&&(n=n.replace(c,"")),n}};e.exports={start:s(1),end:s(2),trim:s(3)}},7424:function(e,t){var n="v1",r="http://127.0.0.1:8888";e.exports={SYSTEM_NAME:"".concat(n,"/name"),LOGIN:"".concat(n,"/admin/user/login"),ROUTES:"".concat(n,"/routes"),NODES_MODULE:"".concat(n,"/node/module"),NODES_PIKA:"".concat(n,"/node/pika"),QUERY_DATA:"".concat(n,"/query/data"),All_API:"".concat(r,"/all"),HISTORY:"".concat(r,"/history"),REQUEST_API:"".concat(r,"/"),PID:"".concat(n,"/restart/pid"),RESTART:"".concat(n,"/restart/do"),LOG:"".concat(n,"/restart/log"),SYNC_MAP:"".concat(n,"/restart/sync/map"),PLAYER_INFO:"".concat(n,"/admin/player/info"),MAIL_INFO:"".concat(n,"/admin/player/mail/info"),MAIL_SEND:"".concat(n,"/admin/player/mail/send"),MAIL_DEL:"".concat(n,"/admin/player/mail/delete"),MAIL_ENTIRE:"".concat(n,"/admin/player/mail/entire"),PLAYER_KICK_OFF:"".concat(n,"/admin/player/kick/off"),ANNOUNCEMENT_INFO:"".concat(n,"/announcement"),ANNOUNCEMENT_LIST:"".concat(n,"/announcement/list"),ANNOUNCEMENT_SAVE:"".concat(n,"/announcement/save"),ANNOUNCEMENT_DEL:"".concat(n,"/announcement/del"),BATTLE_LOG_FILES:"".concat(n,"/battle/log/files"),BATTLE_LOG_DEL:"".concat(n,"/battle/log/del"),BATTLE_LOG_DOWNLOAD:"".concat(n,"/battle/log/download"),BUILD_DO:"".concat(n,"/build/do"),BUILD_LOG:"".concat(n,"/build/log"),VERSION_INFO:"".concat(n,"/version/info"),VERSION_SAVE:"".concat(n,"/version/save"),VERSION_UPLOAD:"".concat(n,"/version/file"),VERSION_UPLOAD_ZIP:"".concat(n,"/version/zip"),BROADCAST_SEND:"".concat(n,"/broadcast/send"),WL_LIST:"".concat(n,"/whitelist/list"),WL_SAVE:"".concat(n,"/whitelist/save"),WL_DEL:"".concat(n,"/whitelist/del"),GITLAB_MEMBERS:"".concat(n,"/gitlab/members"),GITLAB_MODIFY:"".concat(n,"/gitlab/modify"),CDKEY_SAVE:"".concat(n,"/cdkey/save"),CDKEY_DEACTIVE:"".concat(n,"/cdkey/deactive"),BWL_LIST:"".concat(n,"/beta/whitelist/list"),BWL_SAVE:"".concat(n,"/beta/whitelist/save"),BWL_DEL:"".concat(n,"/beta/whitelist/del"),MAP_LINE_INFO:"".concat(n,"/map/line/info")}},c8d2:function(e,t,n){var r=n("d039"),a=n("5899"),o="​᠎";e.exports=function(e){return r((function(){return!!a[e]()||o[e]()!=o||a[e].name!==e}))}},e931:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-card",[n("a-button",{attrs:{icon:"plus",type:"primary"},on:{click:e.newAnnouncement}},[e._v("新增公告")]),n("br"),n("br"),n("a-table",{attrs:{columns:e.columns,"data-source":e.list,pagination:!1,size:"small"},scopedSlots:e._u([{key:"type",fn:function(t){return n("span",{},[e._v(" "+e._s(e.announcementType[t])+" ")])}},{key:"show_login",fn:function(t){return n("span",{},[e._v(" "+e._s(t?"是":"否")+" ")])}},{key:"store_url",fn:function(t){return n("span",{},[n("a-tooltip",{attrs:{placement:"left"}},[n("template",{slot:"title"},[n("span",[e._v(e._s(t))])]),n("a",{attrs:{href:t}},[e._v(e._s(t))])],2)],1)}},{key:"content",fn:function(t){return n("span",{},[n("a-tooltip",{attrs:{placement:"left"}},[n("template",{slot:"title"},[n("span",[e._v(e._s(t))])]),n("span",[e._v(e._s(t))])],2)],1)}},{key:"action",fn:function(t){return n("span",{},[n("a-space",[n("a-tooltip",{attrs:{placement:"left"}},[n("template",{slot:"title"},[n("span",[e._v("复制")])]),n("a-button",{attrs:{icon:"copy",shape:"circle",type:"primary",size:"small"},on:{click:function(n){return e.showCopy(t)}}})],2),n("a-tooltip",{attrs:{placement:"left"}},[n("template",{slot:"title"},[n("span",[e._v("修改")])]),n("a-button",{attrs:{icon:"edit",shape:"circle",type:"primary",size:"small"},on:{click:function(n){return e.showUpdate(t)}}})],2),n("a-tooltip",{attrs:{placement:"right"}},[n("template",{slot:"title"},[n("span",[e._v("删除")])]),n("a-button",{attrs:{icon:"delete",shape:"circle",type:"danger",size:"small"},on:{click:function(n){return e.deleteAnnouncement(t.id)}}})],2)],1)],1)}}])}),n("a-modal",{attrs:{width:"70%",title:e.form.id?"公告修改":"新增公告",maskClosable:!1,"dialog-style":{top:"20px"},"confirm-loading":e.loading,"ok-text":"保存","cancel-text":"取消"},on:{ok:e.save,cancel:e.cancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("a-form-model",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[n("a-form-model-item",{attrs:{label:"公告类型",prop:"type","has-feedback":!0}},[n("a-select",{attrs:{value:e.type,disabled:!!e.form.id,placeholder:"请选择公告类型"},on:{change:e.typeChange}},e._l(e.announcementType,(function(t,r){return n("a-select-option",{key:t,attrs:{value:r}},[e._v(" "+e._s(t)+" ")])})),1)],1),n("a-form-model-item",{attrs:{label:"版本",prop:"version","has-feedback":!0}},[n("a-input",{attrs:{disabled:!!e.form.id,placeholder:"请输入公告对应的客户端版本"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}})],1),n("a-form-model-item",{attrs:{label:"开始时间",prop:"begin_time","has-feedback":!0}},[n("a-date-picker",{staticStyle:{width:"100%"},attrs:{"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择公告开始时间"},model:{value:e.form.begin_time,callback:function(t){e.$set(e.form,"begin_time",t)},expression:"form.begin_time"}})],1),n("a-form-model-item",{attrs:{label:"结束时间",prop:"end_time","has-feedback":!0}},[n("a-date-picker",{staticStyle:{width:"100%"},attrs:{"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择公告结束时间"},model:{value:e.form.end_time,callback:function(t){e.$set(e.form,"end_time",t)},expression:"form.end_time"}})],1),"normal"===e.form.type?n("a-form-model-item",{attrs:{label:"是否在登录时显示"}},[n("a-switch",{attrs:{checked:e.showLogin},on:{change:e.switchChange}},[n("a-icon",{attrs:{slot:"checkedChildren",type:"check"},slot:"checkedChildren"}),n("a-icon",{attrs:{slot:"unCheckedChildren",type:"close"},slot:"unCheckedChildren"})],1)],1):e._e(),n("a-form-model-item",{attrs:{label:"商店地址"}},[n("a-input",{attrs:{placeholder:"请输入app下载地址"},model:{value:e.form.store_url,callback:function(t){e.$set(e.form,"store_url",t)},expression:"form.store_url"}})],1),n("a-form-model-item",{attrs:{label:"中文公告",required:"","has-feedback":!0}},[n("a-input",{attrs:{type:"textarea","auto-size":{minRows:4},placeholder:"请输入公告的中文内容"},model:{value:e.form.content_cn,callback:function(t){e.$set(e.form,"content_cn",t)},expression:"form.content_cn"}})],1),n("a-form-model-item",{attrs:{label:"英文公告",required:"","has-feedback":!0}},[n("a-input",{attrs:{type:"textarea","auto-size":{minRows:4},placeholder:"请输入公告的英文内容"},model:{value:e.form.content_en,callback:function(t){e.$set(e.form,"content_en",t)},expression:"form.content_en"}})],1),n("a-form-model-item",{attrs:{label:"繁体公告",required:"","has-feedback":!0}},[n("a-input",{attrs:{type:"textarea","auto-size":{minRows:4},placeholder:"请输入公告的繁体内容"},model:{value:e.form.content_traditional,callback:function(t){e.$set(e.form,"content_traditional",t)},expression:"form.content_traditional"}})],1)],1)],1)],1)},a=[],o=(n("4160"),n("c975"),n("d3b7"),n("498a"),n("159b"),n("ddb0"),n("96cf"),n("1da1")),i=n("7424"),c=n("b775");function s(e,t){return Object(c["e"])(i["ANNOUNCEMENT_INFO"]+"/"+t,c["a"].GET,{type:e,web:1})}function l(){return Object(c["e"])(i["ANNOUNCEMENT_LIST"],c["a"].GET)}function m(e){return Object(c["e"])(i["ANNOUNCEMENT_SAVE"],c["a"].POST,e)}function u(e){return Object(c["e"])(i["ANNOUNCEMENT_DEL"],c["a"].POST,{id:e})}var d=[{title:"公告类型",dataIndex:"type",width:100,scopedSlots:{customRender:"type"}},{title:"版本",dataIndex:"version",width:100},{title:"开始时间",dataIndex:"begin_time",width:150},{title:"结束时间",dataIndex:"end_time",width:150},{title:"是否在登录时显示",dataIndex:"show_login",width:130,scopedSlots:{customRender:"show_login"}},{title:"公告内容",dataIndex:"content",ellipsis:!0,scopedSlots:{customRender:"content"}},{title:"商店地址",dataIndex:"store_url",width:200,ellipsis:!0,scopedSlots:{customRender:"store_url"}},{title:"操作",width:100,scopedSlots:{customRender:"action"}}],p={maintenance:"停服维护",normal:"正常",force_update:"强更"},f={id:void 0,type:void 0,version:void 0,begin_time:void 0,end_time:void 0,store_url:void 0,content_cn:void 0,content_en:void 0,show_login:!0},_={name:"Announcement",components:{},data:function(){var e=function(e,t,n){return t?t.indexOf("@")>-1?n(new Error("版本号里不能出现 @ 符号")):void n():n(new Error("请输入公告对应的客户端版本"))};return{labelCol:{span:4},wrapperCol:{span:14},columns:d,announcementType:p,list:[],visible:!1,loading:!1,type:void 0,showLogin:!1,form:{id:void 0,type:void 0,version:void 0,begin_time:void 0,end_time:void 0,store_url:void 0,content_cn:void 0,content_en:void 0,content_traditional:void 0,show_login:!0},rules:{type:[{required:!0,message:"请选择公告类型",trigger:"blur"}],version:[{required:!0,message:"请输入公告对应的客户端版本",trigger:"blur"},{min:1,max:10,message:"长度为1 ~ 10",trigger:"blur"},{validator:e,trigger:"blur"}],begin_time:[{required:!0,message:"请选择公告开始时间",trigger:"change"}],end_time:[{required:!0,message:"请选择公告结束时间",trigger:"change"}],content_cn:[{required:!0,message:"请输入公告的中文内容",trigger:"blur"},{min:1,max:10240,message:"长度为1 ~ 10240",trigger:"blur"}],content_en:[{required:!0,message:"请输入公告的英文内容",trigger:"blur"},{min:1,max:10240,message:"长度为1 ~ 10240",trigger:"blur"}]}}},created:function(){this.fetchAnnouncement()},methods:{subContent:function(e){var t=10;return e.length>t&&(e=e.substr(0,t)+"..."),e},newAnnouncement:function(){this.visible=!0,this.type=void 0,this.form=Object.assign({},f)},typeChange:function(e){this.type=e,this.form.type=e},fetchAnnouncement:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r,a,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,l();case 3:if(n=t.sent,r=n.data,a=r.code,o=r.msg,0===a){t.next=9;break}return e.$message.error(o),t.abrupt("return");case 9:i=r.data||[],i.forEach((function(t){t.key=t.id,t.begin_time=e.$convertTime(new Date(t.begin_time),"YYYY-MM-DD HH:mm:ss"),0===t.end_time?t.end_time="永久有效":t.end_time=e.$convertTime(new Date(t.end_time),"YYYY-MM-DD HH:mm:ss")})),i.sort((function(e,t){return t.created_at-e.created_at})),e.list=i,t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](0),e.$message.error(t.t0.message);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},fetchAnnouncementDetail:function(e,t){var n=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a,o,i,c,l,m;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,s(e,t);case 3:if(a=r.sent,o=a.data,i=o.code,c=o.msg,0===i){r.next=9;break}return n.$message.error(c),r.abrupt("return");case 9:l=o.data||{},n.form=Object.assign({},l[e]),n.form.type=e,n.form.version=t,n.form.begin_time=n.$convertTime(new Date(n.form.begin_time),"YYYY-MM-DD HH:mm:ss"),n.form.end_time?n.form.end_time=n.$convertTime(new Date(n.form.end_time),"YYYY-MM-DD HH:mm:ss"):n.form.end_time=null,m=JSON.parse(l[e].content),n.form.content_en=m[10],n.form.content_cn=m[40],n.form.content_traditional=m[41],r.next=24;break;case 21:r.prev=21,r.t0=r["catch"](0),n.$message.error(r.t0.message);case 24:case"end":return r.stop()}}),r,null,[[0,21]])})))()},showUpdate:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.type=e.type,t.showLogin=e.show_login,n.next=4,t.fetchAnnouncementDetail(e.type,e.version);case 4:t.visible=!0;case 5:case"end":return n.stop()}}),n)})))()},showCopy:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.type=e.type,t.showLogin=e.show_login,n.next=4,t.fetchAnnouncementDetail(e.type,e.version);case 4:t.visible=!0,t.form.id=void 0;case 6:case"end":return n.stop()}}),n)})))()},deleteAnnouncement:function(e){var t=this;this.$confirm({title:"确定删除？",content:"删除后无法恢复，确定删除该公告吗？",onOk:function(){t.doDel(e)},onCancel:function(){}})},save:function(){var e=this,t=this;this.$refs.form.validate(function(){var n=Object(o["a"])(regeneratorRuntime.mark((function n(r){var a,o,i,c,s,l,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!r){n.next=43;break}if(n.prev=1,a=Object.assign({},e.form),delete a.content_cn,delete a.content_en,delete a.content_traditional,a.begin_time=new Date(a.begin_time).getTime(),a.end_time=new Date(a.end_time).getTime(),!(a.begin_time>=a.end_time)){n.next=11;break}return e.$message.error("结束时间必须大于开始时间"),n.abrupt("return");case 11:o={10:(e.form.content_en||"").trim(),40:(e.form.content_cn||"").trim(),41:(e.form.content_traditional||"").trim()},n.t0=regeneratorRuntime.keys(o);case 13:if((n.t1=n.t0()).done){n.next=19;break}if(i=n.t1.value,!(o[i].length<1||o[i].length>10240)){n.next=17;break}return n.abrupt("return",t.$message.error("公告内容长度为1 ~ 10240"));case 17:n.next=13;break;case 19:return a.content=JSON.stringify(o),e.loading=!0,n.next=23,m(a);case 23:if(c=n.sent,s=c.data,l=s.code,u=s.msg,0===l){n.next=30;break}return e.$message.error(u),e.loading=!1,n.abrupt("return");case 30:return e.visible=!1,e.loading=!1,n.next=34,e.fetchAnnouncement();case 34:e.$message.success("保存成功"),n.next=41;break;case 37:n.prev=37,n.t2=n["catch"](1),e.loading=!1,t.$message.error(n.t2.message);case 41:n.next=44;break;case 43:return n.abrupt("return",!1);case 44:case"end":return n.stop()}}),n,null,[[1,37]])})));return function(e){return n.apply(this,arguments)}}())},doDel:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,a,o,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,u(e);case 3:if(r=n.sent,a=r.data,o=a.code,i=a.msg,0===o){n.next=9;break}return t.$message.error(i),n.abrupt("return");case 9:return n.next=11,t.fetchAnnouncement();case 11:t.$message.success("删除成功"),n.next=17;break;case 14:n.prev=14,n.t0=n["catch"](0),t.$message.error(n.t0.message);case 17:case"end":return n.stop()}}),n,null,[[0,14]])})))()},cancel:function(){this.$refs.form.resetFields(),this.form=Object.assign({},f),this.visible=!1},switchChange:function(e){this.showLogin=e,this.form.show_login=e}}},g=_,h=n("0c7c"),b=Object(h["a"])(g,r,a,!1,null,"42ff9342",null);t["default"]=b.exports}}]);