(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ed5733a6"],{7424:function(e,t){var a="/v1",r="http://127.0.0.1:8888";e.exports={SYSTEM_NAME:"".concat(a,"/name"),LOGIN:"".concat(a,"/admin/user/login"),ROUTES:"".concat(a,"/routes"),NODES_MODULE:"".concat(a,"/node/module"),NODES_PIKA:"".concat(a,"/node/pika"),QUERY_DATA:"".concat(a,"/query/data"),All_API:"".concat(r,"/all"),HISTORY:"".concat(r,"/history"),REQUEST_API:"".concat(r,"/"),PID:"".concat(a,"/restart/pid"),RESTART:"".concat(a,"/restart/do"),LOG:"".concat(a,"/restart/log"),SYNC_MAP:"".concat(a,"/restart/sync/map"),OVERWRITE_DEV:"".concat(a,"/restart/overwrite/dev"),PLAYER_INFO:"".concat(a,"/admin/player/info"),MAIL_INFO:"".concat(a,"/admin/player/mail/info"),MAIL_SEND:"".concat(a,"/admin/player/mail/send"),MAIL_DEL:"".concat(a,"/admin/player/mail/delete"),MAIL_ENTIRE:"".concat(a,"/admin/player/mail/entire"),PLAYER_KICK_OFF:"".concat(a,"/admin/player/kick/off"),ANNOUNCEMENT_INFO:"".concat(a,"/announcement"),ANNOUNCEMENT_LIST:"".concat(a,"/announcement/list"),ANNOUNCEMENT_SAVE:"".concat(a,"/announcement/save"),ANNOUNCEMENT_DEL:"".concat(a,"/announcement/del"),BATTLE_LOG_FILES:"".concat(a,"/battle/log/files"),BATTLE_LOG_DEL:"".concat(a,"/battle/log/del"),BATTLE_LOG_DOWNLOAD:"".concat(a,"/battle/log/download"),BUILD_DO:"".concat(a,"/build/do"),BUILD_LOG:"".concat(a,"/build/log"),VERSION_INFO:"".concat(a,"/version/info"),VERSION_SAVE:"".concat(a,"/version/save"),VERSION_UPLOAD:"".concat(a,"/version/file"),VERSION_UPLOAD_ZIP:"".concat(a,"/version/zip"),BROADCAST_SEND:"".concat(a,"/broadcast/send"),WL_LIST:"".concat(a,"/whitelist/list"),WL_SAVE:"".concat(a,"/whitelist/save"),WL_DEL:"".concat(a,"/whitelist/del"),GITLAB_MEMBERS:"".concat(a,"/gitlab/members"),GITLAB_MODIFY:"".concat(a,"/gitlab/modify"),CDKEY_SAVE:"".concat(a,"/cdkey/save"),CDKEY_DEACTIVE:"".concat(a,"/cdkey/deactive"),BWL_LIST:"".concat(a,"/beta/whitelist/list"),BWL_SAVE:"".concat(a,"/beta/whitelist/save"),BWL_DEL:"".concat(a,"/beta/whitelist/del"),MAP_LINE_INFO:"".concat(a,"/map/line/info")}},7695:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",[a("a-tabs",{attrs:{"default-active-key":"save"}},[a("a-tab-pane",{key:"save",attrs:{tab:"生成兑换码"}},[a("a-form-model",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-form-model-item",{attrs:{label:"类型",prop:"type"}},[a("a-radio-group",{attrs:{"default-value":e.form.type},on:{change:e.typeChange}},[a("a-radio",{attrs:{value:1}},[e._v(" 固定 ")]),a("a-radio",{attrs:{value:2}},[e._v(" 随机 ")])],1)],1),1===e.form.type?a("a-form-model-item",{attrs:{label:"兑换码",prop:"id","has-feedback":!0}},[a("a-input",{attrs:{placeholder:"请输入兑换码"},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1):e._e(),a("a-form-model-item",{attrs:{label:"使用限制",prop:"limit_typ","has-feedback":!0}},[a("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择次数限制"},on:{change:e.limitTypChange}},[a("a-select-option",{attrs:{value:1}},[e._v(" 多人单次 ")]),a("a-select-option",{attrs:{value:2}},[e._v(" 单人单次 ")]),a("a-select-option",{attrs:{value:3}},[e._v(" 多人单次且限定次数 ")])],1)],1),a("a-form-model-item",{attrs:{label:"有效时间",required:""}},[a("a-date-picker",{attrs:{"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择生效时间"},on:{openChange:e.handleActivatedAtOpenChange},model:{value:e.form.begin_at,callback:function(t){e.$set(e.form,"begin_at",t)},expression:"form.begin_at"}}),e._v(" ~ "),a("a-date-picker",{attrs:{"show-time":"",format:"YYYY-MM-DD HH:mm:ss",placeholder:"请选择过期时间",open:e.expiredAtOpen},on:{openChange:e.handleExpiredAtOpenOpenChange},model:{value:e.form.end_at,callback:function(t){e.$set(e.form,"end_at",t)},expression:"form.end_at"}})],1),3===e.form.limit_typ?a("a-form-model-item",{attrs:{label:"使用限制",prop:"limit_cnt","has-feedback":!0}},[a("a-input",{attrs:{placeholder:"限制使用次数"},model:{value:e.form.limit_cnt,callback:function(t){e.$set(e.form,"limit_cnt",t)},expression:"form.limit_cnt"}})],1):e._e(),2===e.form.type?a("a-form-model-item",{attrs:{label:"数量",prop:"batch_cnt","has-feedback":!0}},[a("a-input",{attrs:{placeholder:"生成数量"},model:{value:e.form.batch_cnt,callback:function(t){e.$set(e.form,"batch_cnt",t)},expression:"form.batch_cnt"}})],1):e._e(),a("a-form-model-item",{attrs:{label:"奖励",prop:"reward"}},[a("a-input",{attrs:{type:"textarea",placeholder:"和配置表格式一致{101:10,102:10}"},model:{value:e.form.reward,callback:function(t){e.$set(e.form,"reward",t)},expression:"form.reward"}})],1),a("a-form-model-item",{attrs:{"wrapper-col":{span:14,offset:4}}},[a("a-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.onSubmit}},[e._v(" 生成兑换码 ")])],1)],1)],1),a("a-tab-pane",{key:"deactive",attrs:{tab:"废除兑换码"}},[a("a-form-model",{ref:"deactiveForm",attrs:{model:e.deactiveForm,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-form-model-item",{attrs:{label:"批次",prop:"deactive","has-feedback":!0}},[a("a-input",{attrs:{placeholder:"请输入批次"},model:{value:e.deactiveForm.id,callback:function(t){e.$set(e.deactiveForm,"id",t)},expression:"deactiveForm.id"}})],1),a("a-form-model-item",{attrs:{"wrapper-col":{span:14,offset:4}}},[a("a-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.doDeactive}},[e._v(" 废除 ")])],1)],1)],1)],1)],1)},n=[],o=(a("ac1f"),a("1276"),a("96cf"),a("1da1")),c=a("b85c"),i=a("7424"),l=a("b775");function s(e){return Object(l["e"])(i["CDKEY_SAVE"],l["a"].POST,e)}function m(e){return Object(l["e"])(i["CDKEY_DEACTIVE"],l["a"].GET,{batch_id:e})}var d={name:"Announcement",components:{},data:function(){return{labelCol:{span:4},wrapperCol:{span:14},loading:!1,form:{id:void 0,begin_at:void 0,end_at:void 0,limit_cnt:1,limit_typ:void 0,reward:void 0,type:1,batch_cnt:1},deactiveForm:{id:void 0},expiredAtOpen:!1,rules:{type:[{required:!0,message:"请选择兑换码类型",trigger:"blur"}],id:[{required:!0,message:"请输入兑换码",trigger:"blur"},{min:1,max:32,message:"长度为1 ~ 32",trigger:"blur"}],limit_typ:[{required:!0,message:"请选择使用限制",trigger:"blur"}],reward:[{required:!0,message:"请输入兑换码奖励",trigger:"blur"}],deactive:[{required:!0,message:"请输入批次",trigger:"blur"},{min:1,max:32,message:"长度为1 ~ 32",trigger:"blur"}]}}},created:function(){},methods:{subContent:function(e){var t=10;return e.length>t&&(e=e.substr(0,t)+"..."),e},typeChange:function(e){var t=e.target.value;this.form.id=void 0,this.form.type=t,2===t?this.form.id=Date.now()+"":this.form.batch_cnt=1},limitTypChange:function(e){this.form.limit_typ=e,3!==e&&(this.form.limit_cnt=1)},handleActivatedAtOpenChange:function(e){e||(this.expiredAtOpen=!0)},handleExpiredAtOpenOpenChange:function(e){this.expiredAtOpen=e},validateReward:function(){try{var e,t=this.form.reward.substring(1,this.form.reward.length-1),a=t.split(","),r=Object(c["a"])(a);try{for(r.s();!(e=r.n()).done;){var n=e.value,o=n.split(":");if(2!==o.length)return!1;if(isNaN(o[0])||isNaN(o[1]))return!1}}catch(i){r.e(i)}finally{r.f()}}catch(l){return!1}return!0},onSubmit:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r,n,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.prev=0,e.$refs.form.validate(),t.next=7;break;case 4:return t.prev=4,t.t0=t["catch"](0),t.abrupt("return");case 7:if(!(new Date(e.form.begin_at).getTime()>=new Date(e.form.end_at).getTime())){t.next=10;break}return e.$message.error("激活时间不能大于过期时间"),t.abrupt("return");case 10:if(!(new Date(e.form.end_at).getTime()<=Date.now())){t.next=13;break}return e.$message.error("过期时间不能小于当前时间"),t.abrupt("return");case 13:if(e.validateReward()){t.next=16;break}return e.$message.error("奖励数据格式有误"),t.abrupt("return");case 16:if(e.form.batch_cnt=+e.form.batch_cnt,!isNaN(e.form.batch_cnt)){t.next=20;break}return e.$message.error("数量有误"),t.abrupt("return");case 20:return t.prev=20,e.loading=!0,a={id:e.form.id,begin_at:new Date(e.form.begin_at).getTime(),end_at:new Date(e.form.end_at).getTime(),limit_cnt:+e.form.limit_cnt,limit_typ:e.form.limit_typ,reward:e.form.reward,typ:e.form.type,batch_cnt:e.form.batch_cnt},t.next=25,s(a);case 25:if(r=t.sent,n=r.data,o=n.code,c=n.msg,0===o){t.next=32;break}return e.loading=!1,e.$message.error(c),t.abrupt("return");case 32:e.loading=!1,e.$message.success("生成成功"),t.next=40;break;case 36:t.prev=36,t.t1=t["catch"](20),e.loading=!1,e.$message.success("失败:"+t.t1.message);case 40:case"end":return t.stop()}}),t,null,[[0,4],[20,36]])})))()},doDeactive:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:t.prev=0,e.$refs.deactiveForm.validate(),t.next=7;break;case 4:return t.prev=4,t.t0=t["catch"](0),t.abrupt("return");case 7:return t.prev=7,t.next=10,m(e.deactiveForm.id);case 10:if(a=t.sent,r=a.data,n=r.code,o=r.msg,0===n){t.next=17;break}return e.loading=!1,e.$message.error(o),t.abrupt("return");case 17:e.loading=!1,e.$message.success("废除成功"),t.next=25;break;case 21:t.prev=21,t.t1=t["catch"](7),e.loading=!1,e.$message.success("废除失败:"+t.t1.message);case 25:case"end":return t.stop()}}),t,null,[[0,4],[7,21]])})))()}}},p=d,u=a("0c7c"),f=Object(u["a"])(p,r,n,!1,null,"6074064e",null);t["default"]=f.exports}}]);